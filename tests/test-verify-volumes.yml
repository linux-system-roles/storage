---
#
# To-Do:
# 1. Decrease the amount of output during loop_control
# 2. Test with use_partitions when True
#
- name: Read the /etc/fstab file for volume existence
  command: cat /etc/fstab
  register: fstab_buffer
  changed_when: false

- name: Verify that pool.volumes are absent when pool.state is absent
  include_tasks: "{{ current_pool.state is search('absent') | bool | ternary('test-volumes-absent-helper.yml', 'test-volumes-present-helper.yml') }}"
  loop: "{{ pools_list }}"
  loop_control:
    loop_var: current_pool
